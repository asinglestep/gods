# 红黑树

## 一、性质
（1）节点是红色或者黑色。  
（2）根节点是黑色。  
（3）每个叶节点是黑色。  
（4）每个叶子节点到根的路径上不能有2个连续的红色节点。  
（5）任意节点到其每个叶子节点都包含相同数目的黑色节点。

## 二、插入
### 2.1 插入节点
同二叉树。

### 2.2 插入修复：从插入的节点开始向上修复（n：插入节点，np：插入节点的父节点，nu：插入节点的叔叔节点，npp：插入节点的祖父节点）。
#### 2.2.1 n是根节点
操作：将变成黑色节点。

#### 2.2.2 np是黑色
操作：不处理（此树是一个红黑树）。

#### 2.2.3 np是红色，nu也是红色
操作：np变为黑色，nu变为黑色，npp变为红色，对npp进行修复。  
说明：此时插入一个红色节点违背性质4，将np变成黑色，对于npp违背性质5（np比nu多一个黑色节点），再将nu变成黑色，
对于npp来说已经是一个红黑树了，对于npp的父节点来说，npp的树枝上比npp的兄弟节点多一个黑色几点（np是红色节点，
npp一定是黑色节点，将np和nu变成黑色节点之后，npp就比其兄弟节点多一个黑色节点），将npp变成红色节点，然后对npp进行修复。

#### 2.2.4 np是红色，nu是黑色，n是左节点，np也是左节点
操作：np变为黑色，对npp进行右旋，np的右节点变为红色。  
说明：此时插入一个红色节点违背性质4，将np变成黑色，对于npp违背性质5（np比nu多一个黑色节点），将npp右旋变为np的右节点，（因为nu为黑色节点，
没办法增加一个黑色节点），旋转后np的右子树依然是一个红黑树（由于np是红色节点，np的右子树的黑色节点数应该等于nu的黑色节点数），
但是会比np的左子树多一个黑色节点，将np的右节点变成红色节点，对于np新的父节点来说依然是一个红黑树（np由红色变为黑色，增加一个黑色节点，
把npp右旋，减少一个黑色节点）。

#### 2.2.5 np是红色，nu是黑色，n是右节点，np也是右节点
操作：np变为黑色，对npp进行左旋，np的左节点变为红色。  
说明：此时插入一个红色节点违背性质4，将np变成黑色，对于npp违背性质5（np比nu多一个黑色节点），将npp左旋变为np的左节点，（因为nu为黑色节点，
没办法增加一个黑色节点），旋转后np的左子树依然是一个红黑树（由于np是红色节点，np的左子树的黑色节点数应该等于nu的黑色节点数），
但是会比np的右子树多一个黑色节点，将np的左节点变成红色节点，对于np新的父节点来说依然是一个红黑树（np由红色变为黑色，增加一个黑色节点，
把npp左旋，减少一个黑色节点）。

#### 2.2.6 np是红色，nu是黑色，n是左节点，np是右节点
操作：将np右旋，对np进行处理，同情况2.5。

#### 2.2.7 np是红色，nu是黑色，n是右节点，np是左节点
操作：将np左旋，对np进行处理，同情况2.4。

## 三、删除
### 3.1 删除节点
同二叉树。

### 3.2 删除修复（x：要修复的节点，p：父节点，u：要修复的节点的兄弟节点，ul：要修复的节点的兄弟节点的左节点，ur：要修复的节点的兄弟节点的右节点）。
#### 3.2.1 x是红色
操作：变成黑色。  
说明：x是红色节点，x的父节点一定是黑色，删除黑色节点使黑色节点数减一，将x变成黑色节点使黑色节点数加一，此时依然是一个红黑树。

#### 3.2.2 x是黑色，且是左节点
##### 3.2.2.1 u是黑色，ul是黑色，ur是黑色
操作：u变成红色, 对p进行修复。  
说明：p是一个红黑树，但是对于p的父节点，p会比其兄弟节点少一个黑色节点，对p进行修复。

##### 3.2.2.2 u是黑色，ul是红色，ur是黑色
操作：ul变成p的颜色，将p变成黑色，将u右旋，将p左旋。  
说明：将u右旋（由于ul是红色节点，所以ul的右节点和u的右节点黑色节点数相同，u右旋后依然是一个红黑树），使ul变成新的u，
将p左旋（新的u的左节点和p的左节点的黑色节点数相同，p左旋后依然是一个红黑树），原来的ul变成新的p节点，将p变成黑色，让原来的ul变成
和旧的p相同的颜色，对于旧的p的父节点来说依然是一个红黑树（删除节点之后，p的父节点到x的黑色节点数比到其他叶子节点数少一个，
将p旋转后变成黑色，使p的父节点到x的黑色节点数加一，所以对于p的父节点来说，依然是一个红黑树）。

##### 3.2.2.3 u是黑色，ur是红色，ul可以是红色也可以是黑色
操作：u变成p的颜色，p变成黑色，ur变成黑色，将p左旋。  
说明：删除节点后，x比u少一个黑色节点，因为u是黑色，则ul和x的黑色节点数相同，所以将p左旋，p依然是一个红黑树，
旋转后原来的u成为新的p节点，无论原来的p是什么颜色，旋转后，使p变成黑色，使删除节点的路径上的黑色节点数和删除之前保持一致，
对于新的p节点（原来的u）其左节点会比右节点多一个黑色节点，将ur变成黑色，解决这个问题，将新的p节点变成和旧的p节点相同的颜色，
使新的p节点的父节点依然是一个红黑树。

##### 3.2.2.4. u是红色
操作：u是红色，则p为黑色，将p变为红色，u变为黑色，将p左旋，变成2.2.1，2.2.2，2.2.3的一种，继续对x进行修复。

#### 3.2.3 x是黑色，且是右节点
##### 3.2.3.1 u是黑色，ul是黑色，ur是黑色
操作：u变成红色，对p进行修复.

##### 3.2.3.2 u是黑色，ul是红色，ur是黑色
操作：u变成p的颜色，p变成黑色，ul变成黑色，将p右旋。

##### 3.2.3.3 u是黑色，ur是红色，ul可以是红色也可以是黑色
操作：ur变成p的颜色，将p变成黑色，将u左旋，将p右旋。

##### 3.2.3.4 u是红色
操作：p变为红色，u变成黑色，将p右旋，变成2.3.1，2.3.2，2.3.3的一种，继续对x进行修复。